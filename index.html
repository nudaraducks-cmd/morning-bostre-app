
<!DOCTYPE html>
<html lang="si">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Morning Booster | Madawa Wijesingha</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.5.1/dist/confetti.browser.min.js"></script>
    <style>
        :root { --bg: #0b0f1a; --accent: #00d2ff; --glass: rgba(255, 255, 255, 0.05); }
        body { font-family: 'Segoe UI', sans-serif; background: var(--bg); color: white; min-height: 100vh; display: flex; flex-direction: column; }
        .teacher-header { display: flex; align-items: center; justify-content: center; gap: 20px; padding: 40px 20px; background: linear-gradient(180deg, rgba(0,210,255,0.15), transparent); border-radius: 0 0 40px 40px; margin-bottom: 25px; }
        .teacher-img { width: 90px; height: 90px; border-radius: 20px; border: 2px solid var(--accent); object-fit: cover; }
        .glass-card { background: var(--glass); backdrop-filter: blur(12px); border: 1px solid rgba(255,255,255,0.1); border-radius: 25px; padding: 25px; margin-bottom: 20px; }
        
        /* üî• Streak Flame Animation */
        .streak-container { display: flex; align-items: center; gap: 10px; background: rgba(255,165,0,0.1); padding: 8px 15px; border-radius: 50px; border: 1px solid rgba(255,165,0,0.3); }
        .flame-icon { color: #ff4500; font-size: 1.5rem; animation: flicker 0.6s infinite alternate; }
        @keyframes flicker { 0% { opacity: 0.8; transform: scale(1); } 100% { opacity: 1; transform: scale(1.1); text-shadow: 0 0 10px #ff4500; } }

        /* üéØ Micro-Targeting Insight Box */
        .insight-box { background: linear-gradient(90deg, rgba(0,210,255,0.1), transparent); border-left: 4px solid var(--accent); padding: 15px; border-radius: 0 15px 15px 0; margin-bottom: 20px; font-size: 0.9rem; }

        .booster-btn { background: linear-gradient(135deg, #00d2ff, #3a7bd5); border: none; padding: 18px; border-radius: 20px; font-weight: 800; width: 100%; color: white; box-shadow: 0 8px 20px rgba(0,210,255,0.2); transition: 0.3s; }
        .booster-btn:disabled { background: #444; color: #888; box-shadow: none; cursor: not-allowed; }
        
        #game-view, #review-view { display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: #000; z-index: 10000; padding: 20px; overflow-y: auto; }
        .timer-circle { width: 65px; height: 65px; border: 3px solid var(--accent); border-radius: 50%; display: flex; align-items: center; justify-content: center; margin: 0 auto 20px; font-weight: bold; font-size: 1.4rem; color: var(--accent); }
        .option-btn { background: rgba(255,255,255,0.05); border: 1px solid rgba(255,255,255,0.1); color: white; padding: 16px; margin-bottom: 12px; border-radius: 15px; width: 100%; text-align: left; }
        .option-btn.selected { background: var(--accent); font-weight: bold; color: #000; }
    </style>
</head>
<body>

    <div class="content-wrapper">
        <audio id="snd-correct" src="https://cdn.pixabay.com/audio/2021/08/04/audio_bbd134918e.mp3"></audio>
        <audio id="snd-wrong" src="https://cdn.pixabay.com/audio/2022/03/10/audio_c030d35967.mp3"></audio>

        <div class="teacher-header text-center">
            <img src="ChatGPT Image Dec 28, 2025, 08_23_10 AM.png" class="teacher-img">
            <div><h4 class="fw-bold mb-0">MADAWA WIJESINGHA</h4><div class="small text-accent">CHEMISTRY BOOSTER</div></div>
        </div>

        <div id="dashboard" class="container" style="display:none; max-width: 600px;">
            <div class="d-flex justify-content-between align-items-center mb-3">
                <div class="streak-container">
                    <i class="fas fa-fire flame-icon"></i>
                    <span class="fw-bold"><span id="streak-count">0</span> Day Streak</span>
                </div>
                <div class="small text-white-50"><i class="fas fa-users me-1"></i> <span id="global-count-text">0</span> Played Today</div>
            </div>

            <div class="insight-box" id="insight-box">
                <i class="fas fa-lightbulb text-warning me-2"></i>
                <span id="insight-text">‡∂î‡∂∂‡∑ö ‡∂¥‡∑ä‚Äç‡∂ª‡∂ú‡∂≠‡∑í‡∂∫ ‡∑Ä‡∑í‡∑Å‡∑ä‡∂Ω‡∑ö‡∑Ç‡∂´‡∂∫ ‡∂ö‡∂ª‡∂∏‡∑í‡∂±‡∑ä...</span>
            </div>

            <div class="glass-card">
                <h5 class="fw-bold mb-1" id="greeting-text">...</h5>
                <p id="user-name" class="text-white-50 small mb-4"></p>
                <p id="completion-status" class="text-warning small mb-2 d-none fw-bold">‚ö†Ô∏è You have already completed today's booster!</p>
                <button id="start-btn" class="booster-btn mb-4" onclick="initBooster()">START TODAY BOOSTER</button>
            </div>
            <div class="glass-card"><canvas id="progressChart" height="180"></canvas></div>
        </div>

        </div>

    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script type="module">
        // Firebase configs... (‡∂ë‡∂Ω‡∑ô‡∑É‡∂∏ ‡∂¥‡∑Ä‡∂≠‡∑ì)
        // ... [Firebase Initialization] ...

        // --- New Psychology Logics ---

        function calculateStreak(resultsData, studentId) {
            let streak = 0;
            const dates = Object.keys(resultsData).sort().reverse();
            const today = new Date().toISOString().split('T')[0];
            
            for (let date of dates) {
                if (resultsData[date][studentId]) {
                    streak++;
                } else {
                    if (date !== today) break;
                }
            }
            document.getElementById('streak-count').innerText = streak;
        }

        function generateInsight(scores) {
            const avg = scores.reduce((a, b) => a + b, 0) / (scores.length || 1);
            const box = document.getElementById('insight-text');
            if (avg >= 25) box.innerText = "‡∑Ä‡∑í‡∑Å‡∑í‡∑Ç‡∑ä‡∂ß‡∂∫‡∑í! ‡∂î‡∂∂ ‡∂∏‡∑ö ‡∑É‡∂≠‡∑í‡∂∫‡∑ö ‡∂â‡∑Ñ‡∑Ö‡∂∏ ‡∂Ø‡∂ö‡∑ä‡∑Ç‡∂≠‡∑è ‡∂Ö‡∂≠‡∂ª ‡∂â‡∂±‡∑ä‡∂±‡∑Ä‡∑è. ‡∂∏‡∑ö ‡∑Ä‡∑ö‡∂ú‡∂∫ ‡∂¥‡∑Ä‡∂≠‡∑ä‡∑Ä‡∑è ‡∂ú‡∂±‡∑ä‡∂±.";
            else if (avg >= 10) box.innerText = "‡∑Ñ‡∑ú‡∂≥‡∂∫‡∑í! ‡∂≠‡∑Ä ‡∂¥‡∑ú‡∂©‡∑ä‡∂©‡∂ö‡∑ä ‡∂ã‡∂≠‡∑ä‡∑É‡∑è‡∑Ñ ‡∂ö‡∑Ö‡∑ú‡∂≠‡∑ä ‡∂î‡∂∂‡∂ß ‡∂ª‡∂±‡∑ä ‡∂¥‡∂Ø‡∂ö‡∑ä‡∂ö‡∂∏ ‡∂Ø‡∑í‡∂±‡∂±‡∑ä‡∂± ‡∂¥‡∑î‡∑Ö‡∑î‡∑Ä‡∂±‡∑ä.";
            else box.innerText = "‡∂Ö‡∂Ø ‡∂∂‡∑ñ‡∑É‡∑ä‡∂ß‡∂ª‡∑ä ‡∂ë‡∂ö ‡∂Ö‡∑Ä‡∑É‡∑è‡∂±‡∂∫‡∑ö ‡∑Ä‡∑ì‡∂©‡∑í‡∂∫‡∑ù ‡∂ë‡∂ö ‡∂Ö‡∂±‡∑í‡∑Ä‡∑è‡∂ª‡∑ä‡∂∫‡∂∫‡∑ô‡∂±‡∑ä‡∂∏ ‡∂∂‡∂Ω‡∂±‡∑ä‡∂±. ‡∂ë‡∂∫ ‡∂î‡∂∂‡∑ö ‡∂Ω‡∂ö‡∑î‡∂´‡∑î ‡∑Ä‡∑ê‡∂©‡∑í ‡∂ö‡∂ª‡∂ú‡∂±‡∑ä‡∂± ‡∂ã‡∂Ø‡∑Ä‡∑ä ‡∑Ä‡∑ô‡∂∫‡∑í.";
        }

        // --- Sync UI update with insights ---
        async function loadChart() {
            const snap = await get(ref(db, `results`)); 
            if(!snap.exists()) return;
            const data = snap.val();
            const studentId = session.id;

            // Calculate Streak
            calculateStreak(data, studentId);

            const dates = Object.keys(data).sort().slice(-7);
            const scores = dates.map(d => data[d][studentId]?.score || 0);
            
            // Generate Personal Insight
            generateInsight(scores);

            // Chart Render (‡∂ö‡∂Ω‡∑í‡∂±‡∑ä ‡∂≠‡∑í‡∂∂‡∑ñ ‡∑Ä‡∑í‡∂Ø‡∑í‡∑Ñ‡∂ß‡∂∏)
            // ...
        }

        // ... [‡∂Ö‡∂±‡∑ô‡∂ö‡∑ä ‡∑É‡∑í‡∂∫‡∂Ω‡∑î‡∂∏ Game Logic, finishGame function ‡∂¥‡∂ª‡∂´ ‡∑Ä‡∑í‡∂Ø‡∑í‡∑Ñ‡∂ß‡∂∏ ‡∂≠‡∑í‡∂∂‡∑í‡∂∫ ‡∂∫‡∑î‡∂≠‡∑î‡∂∫] ...
    </script>
</body>
</html>
